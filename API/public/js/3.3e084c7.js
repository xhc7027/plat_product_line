(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"/5yV":function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",{staticClass:"create-page page flex"},[s("div",{staticClass:"container full-width"},[s("form",{attrs:{action:"/","data-vv-scope":"bind"}},[s("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],ref:"orderSerialInput",attrs:{name:"serial1",clearable:"",autofocus:"",before:[{icon:"fas fa-barcode",handler:function(){}}],"float-label":"机身条码",placeholder:"输入","auto-complete":"off",spellcheck:"false",disable:1!==e.stage,error:e.errors.has("serial1","bind")},on:{keyup:function(t){return"button"in t||13===t.keyCode?e.save1(t):null}},model:{value:e.orderSerial,callback:function(t){e.orderSerial=t},expression:"orderSerial"}},[s("validate-error",{attrs:{message:"请输入机身条码"}})],1),s("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"serial2",clearable:"",before:[{icon:"fas fa-barcode",handler:function(){}}],"float-label":"APP检测结果条码",placeholder:"输入",spellcheck:"false",disable:1!==e.stage,error:e.errors.has("serial2","bind")},on:{keyup:function(t){return"button"in t||13===t.keyCode?e.save1(t):null}},model:{value:e.resultSerial,callback:function(t){e.resultSerial=t},expression:"resultSerial"}},[s("validate-error",{attrs:{message:"请输入屏幕条码"}})],1),s("div",{staticClass:"row"},[s("div",{staticClass:"col-4"},[s("q-select",{staticClass:"clients-select",attrs:{disable:1!==e.stage,"float-label":"业务方",options:e.sources},model:{value:e.source,callback:function(t){e.source=t},expression:"source"}})],1),s("div",{staticClass:"col-4"}),s("div",{staticClass:"col-4"},[s("q-btn",{directives:[{name:"show",rawName:"v-show",value:1===e.stage,expression:"stage === 1"}],staticClass:"save-btn save1-btn",attrs:{color:"secondary",width:"200",size:"md",label:"提交"},on:{click:function(t){e.save1()}}})],1)])],1),2===e.stage?s("div",{staticClass:"stage-2"},[e._l(e.extraSections,function(t){return s("div",{key:t.id,staticClass:"sku-questions"},[s("h4",[e._v(e._s(t.label))]),s("hsb-questions",{attrs:{name:"questions1",items:t.questions.filter(function(e){return!e.finished})},model:{value:e.results[t.name],callback:function(s){e.$set(e.results,t.name,s)},expression:"results[s.name]"}})],1)}),s("q-field",{directives:[{name:"show",rawName:"v-show",value:e.stage>1,expression:"stage > 1"}],attrs:{label:"备注","label-width":2}},[s("q-input",{attrs:{type:"textarea",color:"tertiary",rows:"4","text-color":"#666","inverted-light":""},model:{value:e.memo,callback:function(t){e.memo=t},expression:"memo"}})],1)],2):e._e(),s("p",[e._v(" ")]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.stage>2,expression:"stage > 2"}],staticClass:"price-result"},[s("h6",[e._v("估价结果")]),s("p",[s("span",{staticClass:"price"},[e._v(e._s(e._f("money")(e.priceResult)))])])]),s("q-btn",{directives:[{name:"show",rawName:"v-show",value:1!==e.stage,expression:"stage !== 1"}],staticClass:"save-btn save2-btn",attrs:{color:"secondary",label:"提交"},on:{click:function(t){e.save2()}}}),s("q-btn",{directives:[{name:"show",rawName:"v-show",value:1!==e.stage,expression:"stage !== 1"}],staticClass:"cancel-btn",attrs:{color:"tertiary","text-color":"#999",size:"md",label:"取消"},on:{click:function(t){e.cancel()}}}),s("q-btn",{directives:[{name:"show",rawName:"v-show",value:1!==e.stage,expression:"stage !== 1"}],staticClass:"next-btn",attrs:{color:"tertiary","text-color":"secondary",size:"md",label:"继续检测"},on:{click:function(t){e.next()}}})],1),s("p",[e._v(" ")]),s("p",[e._v(" ")])])},a=[];n._withStripped=!0;s("91GP"),s("Z2Ku"),s("L9s1"),s("dRSK"),s("rGqo"),s("yt8O"),s("RW0V"),s("f3/d");var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"field",class:e.name},[s("q-field",{attrs:{helper:"",label:e.label,"label-width":2}},[s("hsb-btn-select",{attrs:{name:e.name,color:"tertiary","text-color":"#666666 ","toggle-color":"secondary",multiple:e.multiple,options:e.computedOptions},on:{input:e.onSelectChange},model:{value:e.dataValue,callback:function(t){e.dataValue=t},expression:"dataValue"}})],1)],1)},o=[];i._withStripped=!0;var l=s("SC7v"),r=s("FzGJ"),c={name:"BtnSelect",props:{value:{type:[String,Array],required:!0},multiple:{type:Boolean,default:!1},color:String,textColor:String,toggleColor:{type:String,default:"primary"},toggleTextColor:String,options:{type:Array,required:!0,validator:function(e){return e.every(function(e){return("label"in e||"icon"in e)&&"value"in e})}},readonly:Boolean,disable:Boolean,noCaps:Boolean,noWrap:Boolean,outline:Boolean,flat:Boolean,dense:Boolean,rounded:Boolean,push:Boolean,size:String,glossy:Boolean,noRipple:Boolean,waitForRipple:Boolean},computed:{},data:function(){return{selected:[]}},methods:{click:function(e,t){var s=this;if(!this.readonly){if(this.multiple)if(this.selected.includes(e)){var n=this.selected.indexOf(e);this.selected.splice(n,1)}else this.selected.push(e);else this.selected=[e];this.$nextTick(function(){JSON.stringify(e)!==JSON.stringify(s.value)&&s.$emit("input",s.selected,t)})}}},render:function(e){var t=this;return e(r["a"],{staticClass:"q-btn-toggle",props:{outline:this.outline,flat:this.flat,rounded:this.rounded,push:this.push}},this.options.map(function(s,n){return e(l["a"],{key:"".concat(s.label).concat(s.icon).concat(s.iconRight),on:{click:function(){return t.click(s.value,s)}},props:{disable:t.disable,label:s.label,color:t.selected.includes(s.value)?s.toggleColor||t.toggleColor:s.color||t.color,textColor:t.selected.includes(s.value)?s.toggleTextColor||t.toggleTextColor:s.textColor||t.textColor,icon:s.icon,iconRight:s.iconRight,noCaps:t.noCaps||s.noCaps,noWrap:t.noWrap||s.noWrap,outline:t.outline,flat:t.flat,rounded:t.rounded,push:t.push,glossy:t.glossy,size:t.size,dense:t.dense,noRipple:t.noRipple||s.noRipple,waitForRipple:t.waitForRipple||s.waitForRipple,tabindex:s.tabindex}})}))}},u={name:"field",props:{type:{type:String,default:"button"},multiple:{type:Boolean,default:!1},value:{type:[String,Array],default:""},label:String,name:String,options:{type:Array,default:function(){return["A","B"]}}},computed:{computedOptions:{get:function(){var e=this.options;return"string"===typeof e[0]&&(e=e.filter(function(e){return e}).map(function(e){return{label:e,value:e}})),e}}},data:function(){return{dataValue:this.value}},methods:{onSelectChange:function(){this.$emit("input",this.dataValue)}},components:{HsbBtnSelect:c},mounted:function(){}},d=u,p=(s("ieA0"),s("KHd+")),f=Object(p["a"])(d,i,o,!1,null,null,null),h=f.exports,m=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"options"},[e._l(e.computedItems,function(t,n){return s("hsb-field",{key:n,attrs:{type:"button",label:t.label,name:t.name,value:e.values["field-"+t.id],multiple:t.multiple||!1,options:t.options},on:{input:function(s){e.onFieldChange(t.name,s)}}})}),s("p",[e._v(" ")])],2)},v=[];m._withStripped=!0;var g={name:"sku-questions",props:{items:Array},computed:{computedItems:function(){return this.items.map(function(e){return e})}},data:function(){return{values:{}}},mounted:function(){},methods:{onFieldChange:function(e,t){t.length?this.values[e]=t:delete this.values[e],this.$emit("input",this.values)}},components:{HsbField:h}},b=g,y=Object(p["a"])(b,m,v,!1,null,null,null),x=y.exports,S={name:"create-page",data:function(){return{stage:1,orderSerial:"",resultSerial:"",source:"xy",sections:[],results:{},memo:"",priceResult:0,sources:[{label:"闲鱼验机",value:"xy"},{label:"OMS",value:"oms"}]}},created:function(){this.addValidateRule()},mounted:function(){this.$refs.orderSerialInput.focus()},computed:{extraSections:function(){return this.sections.filter(function(e){return e.questions.some(function(e){return!e.finished&&e.options.length>0})})}},methods:{save1:function(){var e=this,t={oms:"/bind-oms",xy:"/bind-xy"};this.$validator.validateAll("bind").then(function(s){if(s){var n={orderSerial:e.orderSerial,resultSerial:e.resultSerial,source:e.source};e.$http.post(t[e.source],{data:n}).then(function(t){"0"===t.code?(e.sections=t.data.sections,e.stage=2):e.notice(t.message)})}else e.$refs.orderSerialInput.focus()})},save2:function(){var e=this,t={oms:"/save-oms",xy:"/save-xy"},s=this.extraSections.map(function(e){return e.name}),n=s.length===this.extraSections.length&&s.every(function(t){return Object.keys(e.results[t]).length===e.sections.find(function(e){return e.name===t}).questions.filter(function(e){return!e.finished}).length});if(n){var a={resultSerial:this.resultSerial,source:this.source,memo:this.memo};this.$http.post(t[this.source],{data:a,beforeParams:this.calcBeforeParams}).then(function(t){"0"===t.code?(e.stage=3,e.priceResult=t.data.price-0,e.notice("已保存")):e.notice(t.message)},function(t){e.notice("保存出错")})}else this.notice("有选项未填写")},cancel:function(){this.stage=1},next:function(){this.memo="",this.orderSerial="",this.resultSerial="",this.stage=1,this.sections=[]},openNotify:function(){this.modal("login")},calcBeforeParams:function(e){var t=this;console.log("calBeforefParamas--------",e);var s=JSON.parse(JSON.stringify(this.sections));return s.forEach(function(e){var s=t.results[e.name];s&&e.questions.forEach(function(e){var t=s[e.name];t&&(e.finished=!0,e.options.forEach(function(e){e.selected=t.includes(e.value)}))})}),Object.assign({},{sections:s},e)},addValidateRule:function(){this.$validator.extend("full",function(e,t){return Object.keys(e).length===t.full-0},{paramNames:["full"]})}},components:{HsbField:h,HsbQuestions:x}},C=S,w=(s("zriD"),Object(p["a"])(C,n,a,!1,null,null,null));t["default"]=w.exports},QeCi:function(e,t,s){},ieA0:function(e,t,s){"use strict";var n=s("qLLR"),a=s.n(n);a.a},qLLR:function(e,t,s){},zriD:function(e,t,s){"use strict";var n=s("QeCi"),a=s.n(n);a.a}}]);