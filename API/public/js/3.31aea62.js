(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"/5yV":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"create-page page flex"},[a("div",{staticClass:"container full-width"},[a("form",{attrs:{action:"/","data-vv-scope":"bind"}},[a("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],ref:"orderSerialInput",attrs:{name:"serial1",clearable:"",autofocus:"",before:[{icon:"fas fa-barcode",handler:function(){}}],"float-label":"机身条码",placeholder:"输入","auto-complete":"off",spellcheck:"false",disable:1!==e.stage,error:e.errors.has("serial1","bind")},on:{keyup:function(t){return"button"in t||13===t.keyCode?e.save1(t):null}},model:{value:e.orderSerial,callback:function(t){e.orderSerial=t},expression:"orderSerial"}},[a("validate-error",{attrs:{message:"请输入机身条码"}})],1),a("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"serial2",clearable:"",before:[{icon:"fas fa-barcode",handler:function(){}}],"float-label":"APP检测结果条码",placeholder:"输入",spellcheck:"false",disable:1!==e.stage,error:e.errors.has("serial2","bind")},on:{keyup:function(t){return"button"in t||13===t.keyCode?e.save1(t):null}},model:{value:e.resultSerial,callback:function(t){e.resultSerial=t},expression:"resultSerial"}},[a("validate-error",{attrs:{message:"请输入屏幕条码"}})],1),a("div",{staticClass:"row"},[a("div",{staticClass:"col-4"},[a("q-select",{staticClass:"clients-select",attrs:{disable:1!==e.stage,"float-label":"业务方",options:e.sources},model:{value:e.source,callback:function(t){e.source=t},expression:"source"}})],1),a("div",{staticClass:"col-4"},["xy"===this.source?a("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"order_number","float-label":"订单号",placeholder:"输入",spellcheck:"false",disable:1!==e.stage,error:e.errors.has("order_number","bind")},on:{keyup:function(t){return"button"in t||13===t.keyCode?e.save1(t):null}},model:{value:e.orderNumber,callback:function(t){e.orderNumber=t},expression:"orderNumber"}},[a("validate-error",{attrs:{message:"请输入订单号"}})],1):e._e()],1),a("div",{staticClass:"col-4"},["xy"===this.source?a("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"task_number","float-label":"检测单号",placeholder:"输入",spellcheck:"false",disable:1!==e.stage,error:e.errors.has("task_number","bind")},on:{keyup:function(t){return"button"in t||13===t.keyCode?e.save1(t):null}},model:{value:e.taskNumber,callback:function(t){e.taskNumber=t},expression:"taskNumber"}},[a("validate-error",{attrs:{message:"请输入检测单号"}})],1):e._e()],1)]),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:1===e.stage,expression:"stage === 1"}],staticClass:"save-btn save1-btn",attrs:{color:"secondary",width:"200",size:"md",label:"提交"},on:{click:function(t){e.save1()}}})],1),2===e.stage?a("div",{staticClass:"stage-2"},[e._l(e.extraSections,function(t){return a("div",{key:t.id,staticClass:"sku-questions"},[a("h4",[e._v(e._s(t.label))]),a("hsb-questions",{attrs:{name:"questions1",items:t.questions.filter(function(e){return!e.finished})},model:{value:e.results[t.name],callback:function(a){e.$set(e.results,t.name,a)},expression:"results[s.name]"}})],1)}),a("q-field",{directives:[{name:"show",rawName:"v-show",value:e.stage>1,expression:"stage > 1"}],attrs:{label:"备注","label-width":2}},[a("q-input",{attrs:{type:"textarea",color:"tertiary",rows:"4","text-color":"#666","inverted-light":""},model:{value:e.memo,callback:function(t){e.memo=t},expression:"memo"}})],1)],2):e._e(),a("p",[e._v(" ")]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.stage>2,expression:"stage > 2"}],staticClass:"price-result"},[a("h6",[e._v("估价结果")]),a("p",[a("span",{staticClass:"price"},[e._v(e._s(e._f("money")(e.priceResult)))])])]),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:1!==e.stage,expression:"stage !== 1"}],staticClass:"save-btn save2-btn",attrs:{color:"secondary",label:"提交"},on:{click:function(t){e.save2()}}}),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:1!==e.stage,expression:"stage !== 1"}],staticClass:"cancel-btn",attrs:{color:"tertiary","text-color":"#999",size:"md",label:"取消"},on:{click:function(t){e.cancel()}}}),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:1!==e.stage,expression:"stage !== 1"}],staticClass:"next-btn",attrs:{color:"tertiary","text-color":"secondary",size:"md",label:"继续检测"},on:{click:function(t){e.next()}}})],1),a("p",[e._v(" ")]),a("p",[e._v(" ")])])},n=[];s._withStripped=!0;a("91GP"),a("Z2Ku"),a("L9s1"),a("dRSK"),a("rGqo"),a("yt8O"),a("RW0V"),a("f3/d");var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"field",class:e.name},[a("q-field",{attrs:{helper:"",label:e.label,"label-width":2}},[a("hsb-btn-select",{attrs:{name:e.name,color:"tertiary","text-color":"#666666 ","toggle-color":"secondary",multiple:e.multiple,options:e.computedOptions},on:{input:e.onSelectChange},model:{value:e.dataValue,callback:function(t){e.dataValue=t},expression:"dataValue"}})],1)],1)},r=[];i._withStripped=!0;var o=a("SC7v"),l=a("FzGJ"),u={name:"BtnSelect",props:{value:{type:[String,Array],required:!0},multiple:{type:Boolean,default:!1},color:String,textColor:String,toggleColor:{type:String,default:"primary"},toggleTextColor:String,options:{type:Array,required:!0,validator:function(e){return e.every(function(e){return("label"in e||"icon"in e)&&"value"in e})}},readonly:Boolean,disable:Boolean,noCaps:Boolean,noWrap:Boolean,outline:Boolean,flat:Boolean,dense:Boolean,rounded:Boolean,push:Boolean,size:String,glossy:Boolean,noRipple:Boolean,waitForRipple:Boolean},computed:{},data:function(){return{selected:[]}},methods:{click:function(e,t){var a=this;if(!this.readonly){if(this.multiple)if(this.selected.includes(e)){var s=this.selected.indexOf(e);this.selected.splice(s,1)}else this.selected.push(e);else this.selected=[e];this.$nextTick(function(){JSON.stringify(e)!==JSON.stringify(a.value)&&a.$emit("input",a.selected,t)})}}},render:function(e){var t=this;return e(l["a"],{staticClass:"q-btn-toggle",props:{outline:this.outline,flat:this.flat,rounded:this.rounded,push:this.push}},this.options.map(function(a,s){return e(o["a"],{key:"".concat(a.label).concat(a.icon).concat(a.iconRight),on:{click:function(){return t.click(a.value,a)}},props:{disable:t.disable,label:a.label,color:t.selected.includes(a.value)?a.toggleColor||t.toggleColor:a.color||t.color,textColor:t.selected.includes(a.value)?a.toggleTextColor||t.toggleTextColor:a.textColor||t.textColor,icon:a.icon,iconRight:a.iconRight,noCaps:t.noCaps||a.noCaps,noWrap:t.noWrap||a.noWrap,outline:t.outline,flat:t.flat,rounded:t.rounded,push:t.push,glossy:t.glossy,size:t.size,dense:t.dense,noRipple:t.noRipple||a.noRipple,waitForRipple:t.waitForRipple||a.waitForRipple,tabindex:a.tabindex}})}))}},c={name:"field",props:{type:{type:String,default:"button"},multiple:{type:Boolean,default:!1},value:{type:[String,Array],default:""},label:String,name:String,options:{type:Array,default:function(){return["A","B"]}}},computed:{computedOptions:{get:function(){var e=this.options;return"string"===typeof e[0]&&(e=e.filter(function(e){return e}).map(function(e){return{label:e,value:e}})),e}}},data:function(){return{dataValue:this.value}},methods:{onSelectChange:function(){this.$emit("input",this.dataValue)}},components:{HsbBtnSelect:u},mounted:function(){}},d=c,p=(a("ieA0"),a("KHd+")),f=Object(p["a"])(d,i,r,!1,null,null,null),m=f.exports,h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"options"},[e._l(e.computedItems,function(t,s){return a("hsb-field",{key:s,attrs:{type:"button",label:t.label,name:t.name,value:e.values["field-"+t.id],multiple:t.multiple||!1,options:t.options},on:{input:function(a){e.onFieldChange(t.name,a)}}})}),a("p",[e._v(" ")])],2)},v=[];h._withStripped=!0;var b={name:"sku-questions",props:{items:Array},computed:{computedItems:function(){return this.items.map(function(e){return e})}},data:function(){return{values:{}}},mounted:function(){},methods:{onFieldChange:function(e,t){t.length?this.values[e]=t:delete this.values[e],this.$emit("input",this.values)}},components:{HsbField:m}},g=b,y=Object(p["a"])(g,h,v,!1,null,null,null),x=y.exports,S={name:"create-page",data:function(){return{stage:1,orderSerial:"",resultSerial:"",source:"xy",orderNumber:"",taskNumber:"",sections:[],results:{},memo:"",priceResult:0,sources:[{label:"闲鱼验机",value:"xy"},{label:"OMS",value:"oms"}]}},created:function(){this.addValidateRule()},mounted:function(){this.$refs.orderSerialInput.focus()},computed:{extraSections:function(){return this.sections.filter(function(e){return e.questions.some(function(e){return!e.finished})})}},methods:{save1:function(){var e=this,t={oms:"/bind-oms",xy:"/bind-xy"};this.$validator.validateAll("bind").then(function(a){if(a){var s={orderSerial:e.orderSerial,resultSerial:e.resultSerial,source:e.source};e.$http.post(t[e.source],{data:s}).then(function(t){"0"===t.code?(e.sections=t.data.sections,e.stage=2):e.notice(t.message)})}else e.$refs.orderSerialInput.focus()})},save2:function(){var e=this,t={oms:"/save-oms",xy:"/save-xy"},a=this.extraSections.map(function(e){return e.name}),s=a.length===this.extraSections.length&&a.every(function(t){return Object.keys(e.results[t]).length===e.sections.find(function(e){return e.name===t}).questions.filter(function(e){return!e.finished}).length});if(s){var n={resultSerial:this.resultSerial,source:this.source,memo:this.memo};"xy"===this.source&&(n.orderNumber=this.orderNumber,n.taskNumber=this.taskNumber),this.$http.post(t[this.source],{data:n,beforeParams:this.calcBeforeParams}).then(function(t){0===t.code?(e.stage=3,e.priceResult=t.data.price-0,e.notice("已保存")):e.notice(t.message)},function(t){e.notice("保存出错")})}else this.notice("有选项未填写")},cancel:function(){this.stage=1},next:function(){this.memo="",this.orderSerial="",this.resultSerial="",this.orderNumber="",this.taskNumber="",this.stage=1,this.sections=[]},openNotify:function(){this.modal("Notify")},calcBeforeParams:function(e){var t=this;console.log("calBeforefParamas--------",e);var a=JSON.parse(JSON.stringify(this.sections));return a.forEach(function(e){var a=t.results[e.name];a&&e.questions.forEach(function(e){var t=a[e.name];t&&(e.finished=!0,e.options.forEach(function(e){e.selected=t.includes(e.value)}))})}),Object.assign({},{sections:a},e)},addValidateRule:function(){this.$validator.extend("full",function(e,t){return Object.keys(e).length===t.full-0},{paramNames:["full"]})}},components:{HsbField:m,HsbQuestions:x}},k=S,C=(a("zriD"),Object(p["a"])(k,s,n,!1,null,null,null));t["default"]=C.exports},QeCi:function(e,t,a){},ieA0:function(e,t,a){"use strict";var s=a("qLLR"),n=a.n(s);n.a},qLLR:function(e,t,a){},zriD:function(e,t,a){"use strict";var s=a("QeCi"),n=a.n(s);n.a}}]);